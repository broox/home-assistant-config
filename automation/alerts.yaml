- id: away_from_home
  alias: Everyone is away from home
  trigger:
    platform: state
    entity_id: group.family
    from: home
    to: not_home
  action:
  - service: notify.pushbullet
    data:
      title: Presence
      message: Everyone has left the house
  - service: script.check_garage_door

- id: someone_home
  alias: Someone is home
  trigger:
    platform: state
    entity_id: group.family
    from: not_home
    to: home
  action:
    service: notify.pushbullet
    data:
      title: Presence
      message: Someone is home

- id: hass_update
  alias: Home assistant updated
  trigger:
  - platform: state
    entity_id: updater.updater
  action:
    service: notify.pushbullet
    data:
      title: "Upgrade alert!"
      message: "Home Assistant {{ states.updater.updater.state }} is now available"

- id: garage_door_closed_while_away
  alias: Garage door closed while away
  trigger:
    platform: state
    entity_id: cover.garage_door_opener
    to: closed
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: cover.garage_door_opener
      state: closed
    - condition: state
      entity_id: group.family
      state: not_home
  action:
    service: notify.pushbullet
    data:
      title: Door
      message: Garage door has closed

- id: front_motion
  alias: motion at front door
  trigger:
  - platform: state
    entity_id: binary_sensor.ring_front_door_motion
    from: 'off'
    to: 'on'
  action:
  - service: shell_command.take_snapshot
    data_template:
      url: 'http://localhost:8123{{ states.camera.front.attributes.entity_picture }}'
      filename: '/Users/broox/.homeassistant/www/front_motion.jpg'
  - service: notify.pushbullet
    data:
      title: Motion alert
      message: Motion at front door
      data:
        file: '/Users/broox/.homeassistant/www/front_motion.jpg'
  - service: shell_command.take_snapshot
    data_template:
      url: 'http://localhost:8123{{ states.camera.front_door.attributes.entity_picture }}'
      filename: '/Users/broox/.homeassistant/www/doorbell_motion.jpg'
  - service: notify.pushbullet
    data:
      title: Motion alert
      message: Motion at front door
      data:
        file: '/Users/broox/.homeassistant/www/doorbell_motion.jpg'